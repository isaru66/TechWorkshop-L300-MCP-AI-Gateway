---
title: '4. Build and deploy to Azure Container Apps'
layout: default
nav_order: 4
parent: 'Exercise 03: Getting started with MCP'
---

# Task 04 - Build and deploy to Azure Container Apps

## Introduction

Now that you have tested the MCP server locally, it's time to containerize it and deploy it to Azure Container Apps. This will make your MCP server accessible as a cloud-hosted endpoint.

## Description

In this task, you will build a Docker image for the MCP Weather Mock server and deploy it to Azure Container Apps. You have two options for building the image: using Docker Desktop locally or using Azure Container Registry (ACR) build if you don't have Docker installed.

## Success Criteria

- You have built a Docker image for the MCP server.
- The image is pushed to Azure Container Registry.
- The MCP server is deployed and running on Azure Container Apps.
- You can access the MCP endpoint via the Container App URL.

## Learning Resources

- [Azure Container Apps overview](https://learn.microsoft.com/azure/container-apps/overview)
- [Azure Container Registry](https://learn.microsoft.com/azure/container-registry/container-registry-intro)
- [Build container images in Azure Container Registry](https://learn.microsoft.com/azure/container-registry/container-registry-tutorial-quick-task)

## Key Tasks

### 01: Set up environment variables

Define the environment variables needed for the deployment.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

Open a terminal and set the following variables. Replace the placeholder values with your actual resource names.

**Linux / macOS / Codespace (Bash):**

```bash
RESOURCE_GROUP="<your-resource-group-name>"
ACR_NAME="<your-acr-name>"
CONTAINER_APP_ENV="<your-container-app-environment-name>"
CONTAINER_APP_NAME="mcp-weather-mock"
IMAGE_NAME="mcp-weather-mock"
IMAGE_TAG="v1"
```

**Windows (PowerShell):**

```powershell
$RESOURCE_GROUP="<your-resource-group-name>"
$ACR_NAME="<your-acr-name>"
$CONTAINER_APP_ENV="<your-container-app-environment-name>"
$CONTAINER_APP_NAME="mcp-weather-mock"
$IMAGE_NAME="mcp-weather-mock"
$IMAGE_TAG="v1"
```

{: .note }
> If you deployed resources using the Bicep script in Exercise 02, use the resource group and ACR names from that deployment. You can find them in the Azure portal or by running `az group list --output table` and `az acr list --output table`.

</details>

### 02: Build the Docker image

You have two options for building the Docker image. Choose the option that fits your environment.

#### Option A: Build locally with Docker Desktop

Use this option if you have Docker Desktop or Rancher Desktop installed and running.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

Navigate to the MCP Weather Mock server directory and build the image:

```bash
cd src/01-mcp-weather-mock
```

**Linux / macOS / Codespace:**

```bash
docker build -t $ACR_NAME.azurecr.io/$IMAGE_NAME:$IMAGE_TAG .
```

**Windows (PowerShell):**

```powershell
docker build -t "$ACR_NAME.azurecr.io/$IMAGE_NAME`:$IMAGE_TAG" .
```

Verify the image was built successfully:

```bash
docker images | grep mcp-weather-mock
```

</details>

#### Option B: Build using Azure Container Registry (ACR)

Use this option if you **do not have Docker Desktop installed**. ACR can build Docker images directly in the cloud.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

Navigate to the MCP Weather Mock server directory:

```bash
cd src/01-mcp-weather-mock
```

Use the `az acr build` command to build the image directly in ACR. This sends the source code to Azure and builds the image in the cloud — no local Docker installation required.

**Linux / macOS / Codespace:**

```bash
az acr build \
  --registry $ACR_NAME \
  --resource-group $RESOURCE_GROUP \
  --image $IMAGE_NAME:$IMAGE_TAG \
  .
```

**Windows (PowerShell):**

```powershell
az acr build `
  --registry $ACR_NAME `
  --resource-group $RESOURCE_GROUP `
  --image "${IMAGE_NAME}:${IMAGE_TAG}" `
  .
```

This command will:
1. Upload the source code to ACR.
2. Build the Docker image using the `dockerfile` in the current directory.
3. Push the built image to the ACR repository.

You should see build logs streaming in the terminal, ending with a success message.

{: .note }
> The `az acr build` command is ideal for CI/CD scenarios or when Docker is not available locally. It uses ACR Tasks to build the image in Azure.

</details>

### 03: Push the image to ACR (Local build only)

If you built the image locally (Option A), you need to push it to Azure Container Registry.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

{: .note }
> If you used **Option B** (ACR build) in the previous step, **skip this step** — the image was already pushed to ACR as part of the build process.

First, log in to your Azure Container Registry:

```bash
az acr login --name $ACR_NAME
```

Then push the image:

**Linux / macOS / Codespace:**

```bash
docker push $ACR_NAME.azurecr.io/$IMAGE_NAME:$IMAGE_TAG
```

**Windows (PowerShell):**

```powershell
docker push "$ACR_NAME.azurecr.io/$IMAGE_NAME`:$IMAGE_TAG"
```

Verify the image is in ACR:

```bash
az acr repository list --name $ACR_NAME --output table
```

You should see `mcp-weather-mock` in the list.

</details>

### 04: Deploy to Azure Container Apps

Create a Container App from the image in ACR.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

Deploy the container app using the Azure CLI:

**Linux / macOS / Codespace:**

```bash
az containerapp create \
  --name $CONTAINER_APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINER_APP_ENV \
  --image $ACR_NAME.azurecr.io/$IMAGE_NAME:$IMAGE_TAG \
  --registry-server $ACR_NAME.azurecr.io \
  --target-port 8000 \
  --ingress external \
  --min-replicas 1 \
  --max-replicas 3
```

**Windows (PowerShell):**

```powershell
az containerapp create `
  --name $CONTAINER_APP_NAME `
  --resource-group $RESOURCE_GROUP `
  --environment $CONTAINER_APP_ENV `
  --image "$ACR_NAME.azurecr.io/$IMAGE_NAME`:$IMAGE_TAG" `
  --registry-server "$ACR_NAME.azurecr.io" `
  --target-port 8000 `
  --ingress external `
  --min-replicas 1 `
  --max-replicas 3
```

After the deployment completes, get the application URL:

**Linux / macOS / Codespace:**

```bash
az containerapp show \
  --name $CONTAINER_APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --query "properties.configuration.ingress.fqdn" \
  --output tsv
```

**Windows (PowerShell):**

```powershell
az containerapp show `
  --name $CONTAINER_APP_NAME `
  --resource-group $RESOURCE_GROUP `
  --query "properties.configuration.ingress.fqdn" `
  --output tsv
```

The output will be a URL like `mcp-weather-mock.<region>.azurecontainerapps.io`.

</details>

### 05: Verify the deployment

Test the deployed MCP server to ensure it is working correctly.

<details markdown="block">
<summary><strong>Expand this section to view the solution</strong></summary>

Using the URL from the previous step, test the MCP endpoint. You can use `curl`, the REST Client extension, or a browser.

**Quick test with curl:**

```bash
curl -X POST https://<your-container-app-url>/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05",
      "capabilities": {},
      "clientInfo": {
        "name": "test-client",
        "version": "1.0.0"
      }
    }
  }'
```

**Test with the `.http` file:**

You can also update the `@baseUrl` variable in `src/01-mcp-weather-mock/test/test.http` to point to your deployed Container App:

```http
@baseUrl = https://<your-container-app-url>
```

Then re-run the same requests from Task 03 to verify the deployed server.

{: .note }
> The deployed MCP server URL is your cloud-hosted MCP endpoint. You will use this URL in later exercises when configuring Azure API Management as an AI Gateway to route MCP traffic.

</details>
